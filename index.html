<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="nes.js"></script>
        <script src="kk.js"></script>
        <script src="roswell.js"></script>
    </head>
    <body>
        <div id="input-container">
            <div class="note-input">
                <h2>PWM 1</h2>
                <textarea data-channel="PWM1"></textarea>
            </div>
            <div class="note-input">
                <h2>PWM 2</h2>
                <textarea data-channel="PWM2"></textarea>
            </div>
            <div class="note-input">
                <h2>Triangle</h2>
                <textarea data-channel="TRIANGLE"></textarea>
            </div>
            <div class="note-input">
                <h2>Noise</h2>
                <textarea data-channel="NOISE"></textarea>
            </div>
        </div>
        <footer>
            <span id="controls-container">
                <button id="play">Play</button>
                <button id="stop">Stop</button>
            </span>
            <button data-song-id="KK">Kart Kingdom</button>
            <button data-song-id="Roswell">Roswell</button>
        </footer>

<script>
const channels = ['PWM1', 'PWM2', 'TRIANGLE', 'NOISE'];
const buttons = document.querySelectorAll('footer button[data-song-id]');
for (const button of buttons) {
    button.addEventListener('click', () => {
        const songId = button.dataset.songId;

        // load that song into the text areas
        for (const channel of channels) {
            document.querySelector(`textarea[data-channel=${channel}]`).value = window[songId][channel];
        }
    });
}

document.getElementById('play').addEventListener('click', () => {
    // play whatever's in the textarea
    const sequencerData = {};
    for (const channel of channels) {
        var textarea = document.querySelector(`textarea[data-channel=${channel}]`);
        try {
            sequencerData[channel] = NES.Mml.mmlToMelody(textarea.value);
        } catch(e) {
            console.log(e);
            alert(`Invalid data in the ${channel.toLowerCase()} input!`);
            return;
        }
    }

    // play it in the sequencer
    NES.Sequencer.stop();
    NES.Oscillators.context.resume().then(() => {
        NES.Sequencer.play(sequencerData, true);
    });
});

document.getElementById('stop').addEventListener('click', () => NES.Sequencer.stop());
        </script>
    </body>
</html>
