<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="nes.js"></script>
        <script src="kk.js"></script>
    </head>
    <body>
        <div id="input-container">
            <div class="note-input">
                <h2>PWM 1</h2>
                <textarea data-channel="PWM1"></textarea>
            </div>
            <div class="note-input">
                <h2>PWM 2</h2>
                <textarea data-channel="PWM2"></textarea>
            </div>
            <div class="note-input">
                <h2>Triangle</h2>
                <textarea data-channel="TRIANGLE"></textarea>
            </div>
            <div class="note-input">
                <h2>Noise</h2>
                <textarea data-channel="NOISE"></textarea>
            </div>
        </div>
        <footer>
            <span id="controls-container">
                <button id="stop">Stop</button>
            </span>
            <button data-song-id="KK">Kart Kingdom</button>
        </footer>

<script>
const buttons = document.querySelectorAll('footer button[data-song-id]');
for (const button of buttons) {
    button.addEventListener('click', () => {
        const songId = button.dataset.songId;

        // build the data for the sequencer
        const sequencerData = {};
        for (const channel of ['PWM1', 'PWM2', 'TRIANGLE', 'NOISE']) {
            sequencerData[channel] = NES.Mml.mmlToMelody(window[songId][channel]);
        }

        // play it in the sequencer
        NES.Sequencer.stop();
        NES.Oscillators.context.resume().then(() => {
            NES.Sequencer.play(sequencerData, true);
        });
    });
}

document.getElementById('stop').addEventListener('click', () => NES.Sequencer.stop());
        </script>
    </body>
</html>
